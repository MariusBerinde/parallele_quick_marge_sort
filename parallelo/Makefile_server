CC = srun gcc
CFLAGS = -Wall -g -fopenmp -O3 -march=native #-DOMP_NESTED=1
SRC = src
OUT = out
SOURCES = $(SRC)/main.c $(SRC)/lib.c
TARGET = $(OUT)/main

# Crea la directory out se non esiste e compila
compila_run: $(SOURCES) | $(OUT)
	$(CC) $(CFLAGS) -o $(TARGET) $(SOURCES)

# Esegue il programma
run: compila_run
	srun  $(TARGET)

compila_merge: ./src/merge_mp.c
	srun mpicc -Wall -O3 -fopenmp $(SRC)/merge_mp.c $(SRC)/lib.c -o ./out/merge_mp -lm #-D DEBUG

	# -lm serve per poter usare le librerie matematiche
merge: compila_merge
	srun	mpirun -np 8 ./out/merge_mp 

# Crea la directory out
$(OUT):
	if not exist $(OUT) mkdir $(OUT)

# Pulisce i file generati
clean:
	rm -I $(OUT)/*
.PHONY: clean run

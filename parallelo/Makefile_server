CC = srun gcc
CFLAGS = -Wall -g -fopenmp -O3 -march=native #-DOMP_NESTED=1
SRCDIR = src
OUTDIR = out
SOURCES = $(SRCDIR)/main.c $(SRCDIR)/lib.c
SOURCES2 = $(SRCDIR)/main2.c 
TARGET = $(OUTDIR)/main
TARGET2 = $(OUTDIR)/main2

# Crea la directory out se non esiste e compila
$(TARGET): $(SOURCES) | $(OUTDIR)
	$(CC) $(CFLAGS) -o $(TARGET) $(SOURCES)

# Crea la directory out
$(OUTDIR):
	if not exist $(OUTDIR) mkdir $(OUTDIR)

# Pulisce i file generati
clean:
	rm -I $(OUTDIR)/*

main2: $(SOURCES2)
	$(CC) $(CFLAGS) -o $(TARGET2) $(SOURCES2)

# Esegue il programma
run: $(TARGET)
	srun  $(TARGET)
run2:main2
	srun  --cpus-per-task=36 $(TARGET2)

.PHONY: clean run
